<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Alley Cat 訂位</title>
  <style>
    body {
      background: #000;
      color: #fff;
      font-family: 'Noto Sans', sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
    }

    .top-img, .bottom-img {
      width: 100%;
    }

    .container {
      max-width: 500px;
      margin: 0 auto;
      padding: 20px;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 12px;
    }

    h1 {
      margin: 8px 0 20px;
      font-size: 1.8em;
    }

    .btn-group {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      margin-bottom: 15px;
    }

    .btn {
      background: #222;
      color: #fff;
      border: 1px solid #444;
      border-radius: 6px;
      padding: 8px 14px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn.active { background: #ff6a00; color: #000; }

    input, textarea {
      width: 90%;
      margin: 6px 0;
      padding: 8px;
      border-radius: 6px;
      border: none;
      font-size: 1em;
    }

    button.submit-btn {
      background: #ff6a00;
      border: none;
      color: #000;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 1.1em;
      cursor: pointer;
      position: relative;
    }

    .spinner {
      border: 3px solid rgba(255,255,255,0.3);
      border-top: 3px solid #000;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      animation: spin 1s linear infinite;
      display: inline-block;
      vertical-align: middle;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <img src="./images/top.png" class="top-img" alt="">
  <div class="container">
    <img src="./images/logo.png" width="120" alt="logo">
    <h1 id="title">Alley Cat 訂位</h1>

    <div id="dateButtons" class="btn-group"></div>
    <div id="timeButtons" class="btn-group"></div>

    <input id="name" placeholder="姓名 / Name">
    <input id="phone" placeholder="電話 / Phone">
    <input id="email" placeholder="Email">
    <input id="people" placeholder="人數 / People">
    <textarea id="note" placeholder="備註 / Note"></textarea>

    <button id="submitBtn" class="submit-btn">送出訂位</button>

    <p id="thankYou" style="display:none; margin-top:15px;">🎉 感謝您的訂位，我們將盡快與您聯繫！</p>
  </div>
  <img src="./images/bottom.png" class="bottom-img" alt="">

  <script>
    const lang = navigator.language.slice(0,2);
    const i18n = {
      en: { title: "Alley Cat Reservation", thank: "Thank you for booking!" },
      zh: { title: "Alley Cat 訂位", thank: "感謝您的訂位！" },
      ja: { title: "アリーキャット予約", thank: "ご予約ありがとうございます！" },
      ko: { title: "앨리캣 예약", thank: "예약해 주셔서 감사합니다!" },
      fr: { title: "Réservation Alley Cat", thank: "Merci pour votre réservation!" },
      es: { title: "Reserva Alley Cat", thank: "¡Gracias por su reserva!" },
      de: { title: "Alley Cat Reservierung", thank: "Danke für Ihre Buchung!" },
      th: { title: "จองโต๊ะ Alley Cat", thank: "ขอบคุณสำหรับการจอง!" }
    };
    const L = i18n[lang] || i18n["en"];
    document.getElementById("title").textContent = L.title;

    // 🔗 改成你的 GAS 部署網址
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxMmk-ofJQ25VxjVzfkM7sAPXg0QkZx5J-RbGjzfGgCst5jWdhkD8Oco0CBh66hv6yNHQ/exec";

    async function loadSettings() {
      const res = await fetch(`${GAS_URL}?action=settings`);
      const data = await res.json();
      renderDates(data);
    }

    function renderDates(settings) {
      const container = document.getElementById("dateButtons");
      container.innerHTML = "";
      settings.forEach((s, i) => {
        const d = new Date(s.date);
        const btn = document.createElement("button");
        btn.className = "btn";
        btn.textContent = `${d.toLocaleDateString(lang, { weekday: 'short' })}\n${s.date.slice(5)}`;
        btn.onclick = () => {
          document.querySelectorAll("#dateButtons .btn").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          renderTimes(s.open, s.close, s.interval);
        };
        if (i === 0) btn.classList.add("active");
        container.appendChild(btn);
      });
    }

    function renderTimes(open, close, interval) {
      const container = document.getElementById("timeButtons");
      container.innerHTML = "";
      const [h1, m1] = open.split(":").map(Number);
      const [h2, m2] = close.split(":").map(Number);
      let t = new Date(); t.setHours(h1, m1, 0);
      const end = new Date(); end.setHours(h2, m2, 0);
      while (t <= end) {
        const label = t.toTimeString().slice(0,5);
        const b = document.createElement("button");
        b.className = "btn";
        b.textContent = label;
        b.onclick = () => {
          document.querySelectorAll("#timeButtons .btn").forEach(x => x.classList.remove("active"));
          b.classList.add("active");
        };
        container.appendChild(b);
        t.setMinutes(t.getMinutes() + parseInt(interval));
      }
    }

    document.getElementById("submitBtn").addEventListener("click", async () => {
      const btn = document.getElementById("submitBtn");
      btn.disabled = true;
      btn.innerHTML = `<span class="spinner"></span>`;

      const payload = {
        name: name.value,
        email: email.value,
        phone: phone.value,
        people: people.value,
        note: note.value,
        date: document.querySelector("#dateButtons .active")?.textContent.split("\n")[1],
        time: document.querySelector("#timeButtons .active")?.textContent
      };

      await fetch(GAS_URL, {
        method: "POST",
        body: JSON.stringify(payload),
        headers: { "Content-Type": "application/json" }
      });

      btn.disabled = false;
      btn.textContent = "送出訂位";
      document.getElementById("thankYou").style.display = "block";
      document.getElementById("thankYou").textContent = "🎉 " + L.thank;
    });

    loadSettings();
  </script>
</body>
</html>
